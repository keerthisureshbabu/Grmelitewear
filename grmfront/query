CREATE TABLE IF NOT EXISTS customers (
  id           INT UNSIGNED NOT NULL AUTO_INCREMENT,
  name         VARCHAR(100) NOT NULL,
  email        VARCHAR(191) NOT NULL,
  mobile_num   VARCHAR(20)  NOT NULL,
  password     VARCHAR(255) NOT NULL,     -- store hashed password
  origin       ENUM('direct','facebook','google') NOT NULL DEFAULT 'direct',
  created_at   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at   DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,);

  -- OPTIONAL: choose your DB
-- CREATE DATABASE IF NOT EXISTS grmshop DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
-- USE grmshop;

-- 1) ORDERS (one row per order)
CREATE TABLE IF NOT EXISTS orders (
  id               BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  order_number     VARCHAR(40) NOT NULL,               -- e.g. GRM20250823-000123
  user_id          BIGINT UNSIGNED NOT NULL,           -- customers.id
  user_name        VARCHAR(120) NOT NULL,              -- snapshot for convenience

  -- Money (in paise not used here; using DECIMAL for INR with 2 decimals)
  subtotal_amount  DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  shipping_amount  DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  taxable_value    DECIMAL(10,2) NOT NULL DEFAULT 0.00,

  gst_rate         DECIMAL(5,2)  NOT NULL DEFAULT 0.00, -- e.g. 18.00
  cgst_amount      DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  sgst_amount      DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  igst_amount      DECIMAL(10,2) NOT NULL DEFAULT 0.00,

  grand_total      DECIMAL(10,2) NOT NULL DEFAULT 0.00,

  seller_state     VARCHAR(60)   NOT NULL,            -- from your config (e.g. 'Tamil Nadu')
  buyer_state      VARCHAR(60)   NOT NULL,            -- from shipping address

  shipping_method_code VARCHAR(30) NOT NULL,          -- 'indian_post' | 'st_courier' | 'dtdc'
  shipping_method_name VARCHAR(60) NOT NULL,          -- human label snapshot

  order_status     ENUM('pending','confirmed','packed','shipped','delivered','cancelled','refunded')
                   NOT NULL DEFAULT 'pending',
  payment_status   ENUM('pending','authorized','paid','failed','refunded')
                   NOT NULL DEFAULT 'pending',

  created_at       DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at       DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,

  PRIMARY KEY (id),
  UNIQUE KEY uniq_order_number (order_number),
  KEY idx_orders_user (user_id),
  KEY idx_orders_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


-- 2) ORDER ADDRESSES (normalize so you can also store billing later if needed)
CREATE TABLE IF NOT EXISTS order_addresses (
  id            BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  order_id      BIGINT UNSIGNED NOT NULL,
  type          ENUM('shipping','billing') NOT NULL DEFAULT 'shipping',

  first_name    VARCHAR(80)  NOT NULL,
  last_name     VARCHAR(80)  NOT NULL,
  address1      VARCHAR(255) NOT NULL,
  address2      VARCHAR(255) NULL,
  city          VARCHAR(120) NOT NULL,
  state         VARCHAR(60)  NOT NULL,
  zip_code      VARCHAR(20)  NOT NULL,
  mobile        VARCHAR(20)  NOT NULL,

  created_at    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

  PRIMARY KEY (id),
  KEY idx_addr_order (order_id),
  CONSTRAINT fk_addr_order
    FOREIGN KEY (order_id) REFERENCES orders(id)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


-- 3) ORDER ITEMS (snapshot of cart lines)
CREATE TABLE IF NOT EXISTS order_items (
  id              BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  order_id        BIGINT UNSIGNED NOT NULL,

  product_name    VARCHAR(255) NOT NULL,        -- snapshot to avoid later name changes
  product_code    VARCHAR(100) NULL,            -- your product_code if available
  variation_id    VARCHAR(100) NULL,            -- size/color/variation code if any
  product_type    VARCHAR(40)  NULL,            -- 'women','kids','toy','accessories' (optional)
  image_path      VARCHAR(255) NULL,            -- snapshot

  unit_price      DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  quantity        INT UNSIGNED  NOT NULL DEFAULT 1,
  line_total      DECIMAL(10,2) NOT NULL DEFAULT 0.00,   -- unit_price * quantity

  gst_rate        DECIMAL(5,2)  NULL,           -- keep if you ever move to per-item GST
  created_at      DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

  PRIMARY KEY (id),
  KEY idx_items_order (order_id),
  CONSTRAINT fk_items_order
    FOREIGN KEY (order_id) REFERENCES orders(id)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


-- 4) PAYMENTS (per order; allow retries)
CREATE TABLE IF NOT EXISTS order_payments (
  id                BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  order_id          BIGINT UNSIGNED NOT NULL,

  method            ENUM('upi','debit_card','credit_card') NOT NULL,
  status            ENUM('initiated','authorized','captured','failed','refunded')
                    NOT NULL DEFAULT 'initiated',

  -- UPI
  upi_id            VARCHAR(120) NULL,

  -- Card (DO NOT STORE PAN or CVV)
  card_brand        ENUM('visa','mastercard','rupay','unknown') NULL,
  card_last4        CHAR(4) NULL,
  card_holder       VARCHAR(120) NULL,

  -- Gateway references
  gateway_name      VARCHAR(60)  NULL,
  gateway_order_id  VARCHAR(120) NULL,
  gateway_txn_id    VARCHAR(120) NULL,
  gateway_payload   JSON         NULL,           -- optional for audits

  amount            DECIMAL(10,2) NOT NULL DEFAULT 0.00,

  created_at        DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at        DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,

  PRIMARY KEY (id),
  KEY idx_pay_order (order_id),
  KEY idx_pay_status (status),
  CONSTRAINT fk_pay_order
    FOREIGN KEY (order_id) REFERENCES orders(id)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci; sample insert  